# YOLO标注工具 (YOLO Labeling Tool)

<img src="https://img.shields.io/badge/Python-3.8%2B-blue" alt="Python 3.8+">
<img src="https://img.shields.io/badge/PyQt5-5.15.0%2B-green" alt="PyQt5 5.15.0+">
<img src="https://img.shields.io/badge/YOLOv8-8.0.0%2B-orange" alt="YOLOv8 8.0.0+">

## 项目概述 (Project Overview)

这是一个用于创建、管理和训练YOLO格式目标检测数据集的综合性桌面应用程序。该工具提供图形界面，支持边界框绘制、类别管理、自动标注以及模型训练等功能，帮助用户高效地处理目标检测数据集。

本工具可导入YOLOv8权重文件进行自动标注，并支持带特征点的模型标注和训练。模型训练功能需先配置Conda + CUDA + PyTorch环境。还可以将PT模型转换为ONNX格式，方便在多种推理框架中部署。

## 安装指南 (Installation Guide)

### 系统要求
- Python 3.9（推荐，其他版本可能有未知冲突。已知py3.13有onnx依赖冲突）
- 操作系统: Windows/Linux/MacOS
- Windows: Visual Studio C++编译工具链 https://visualstudio.microsoft.com/visual-cpp-build-tools/

### 安装步骤
1. 克隆或下载此仓库
2. 安装依赖:
   ```bash
   pip install -r requirements.txt
   ```
3. 运行主程序:
   ```bash
   python main.py
   ```

### 训练环境配置
如需使用模型训练功能，请确保已安装:
- Conda环境
- CUDA驱动和工具包(支持GPU训练)
- PyTorch (兼容CUDA版本)
- 其他训练相关依赖项(详见requirements.txt)

## 主要功能 (Main Features)

### 标注功能
- 支持加载和浏览图像文件夹
- 手动绘制、编辑和删除边界框
- 支持多类别标注和类别切换
- 自动保存标注结果为YOLO格式
- 支持键盘快捷键操作
- 图像缩放和平移功能
- 辅助线功能，帮助准确定位

### 特征点标注功能
- 支持在边界框内添加特征点(关键点)
- 左键单击绘制特征点
- 左键拖动移动特征点
- 右键双击删除特征点
- 兼容YOLO关键点检测格式

### 自动标注
- 集成YOLOv5/YOLOv8模型进行自动预测
- 支持单张图像预测和批量自动标注
- 可调整置信度阈值和IoU阈值
- 支持带特征点的模型自动标注

### 训练功能
- 内置YOLOv8训练界面
- 支持选择不同的模型大小(nano/small/medium/large/xlarge)
- 可使用预训练权重或自定义模型
- 支持训练带特征点的模型
- 提供丰富的训练参数设置，包括:
  - 基本参数：批次大小、图像尺寸、训练轮数等
  - 优化器设置：学习率、动量、权重衰减等
  - 数据增强：HSV调整、旋转、平移、缩放、翻转等
  - 其他高级设置：早停策略、设备选择等
- 支持Conda环境选择，一键启动训练
- 支持数据集划分功能，可配置训练/验证/测试比例

### 模型转换功能
- 支持将PyTorch (.pt) 模型转换为ONNX格式
- 可自定义输入图像尺寸、ONNX操作集版本
- 支持模型简化和半精度 (FP16) 转换选项
- 提供友好的图形界面，简化转换流程
- 便于模型在更多推理框架和平台上部署

### 其他辅助功能
- 类别管理系统
- 数据集划分工具
- 模型选择和配置
- 设置管理
- 详细的日志记录

## 操作流程 (Workflow)

### 数据集准备
1. 在主界面点击"打开文件夹"按钮，选择包含图像的文件夹
2. 系统会自动加载所有支持的图像文件（.jpg, .jpeg, .png, .bmp）
3. 如果已有YOLO格式的标注文件，请确保它们与对应图像同名且位于同一文件夹或指定的标签文件夹中

### 手动标注流程
1. 在左侧图像列表中选择需要标注的图像
2. 从右侧类别列表中选择要标注的目标类别
3. 在图像上按住鼠标左键并拖动，绘制边界框
4. 可使用中键(滚轮按下)在图像上拖动平移视图
5. 标注完成后，系统会自动保存为YOLO格式的.txt文件
6. 使用键盘快捷键可以提高标注效率：
   - ← / → ：上一张/下一张图像
   - Delete ：删除选中的边界框
   - Ctrl+S ：手动保存当前标注
   - Ctrl+A ：自动标注当前图像
   - +/- ：放大/缩小图像

### 特征点标注流程
1. 点击"特征点模式"按钮启用特征点标注
2. 选择或创建一个边界框
3. 左键单击在边界框内添加特征点
4. 左键拖动可移动已添加的特征点
5. 右键双击可删除特征点

### 自动标注流程
1. 确保已在设置中配置好YOLO模型路径
2. 选择单张图像，点击"自动标注"按钮进行单图预测
3. 或选择"批量自动标注"对整个文件夹进行处理
4. 在弹出的对话框中设置置信度阈值和IoU阈值
5. 点击确认后，系统会自动进行目标检测并生成标注
6. 自动标注完成后，可以手动调整或修正生成的边界框
7. 支持带特征点的模型自动标注

### 类别管理
1. 点击"类别管理"按钮打开类别编辑界面
2. 可以添加、删除或修改类别名称
3. 修改完成后点击保存，系统会更新类别列表

### 模型训练
1. 点击"训练"按钮打开训练配置界面
2. 设置数据集路径（包含图像和标注的文件夹）
3. 选择YOLO模型大小和预训练权重
4. 配置训练参数：
   - 基本参数：批次大小、图像尺寸、训练轮数等
   - 优化器参数：学习率、动量等
   - 数据增强选项
5. 选择合适的Conda环境（需预先配置好YOLO训练环境）
6. 点击"开始训练"按钮启动训练过程
7. 训练日志会实时显示在界面上，可随时查看训练进度

### 模型转换
1. 在"工具"菜单中选择"PT模型转ONNX"选项
2. 在弹出的对话框中选择输入的PyTorch模型文件
3. 指定保存ONNX模型的输出路径
4. 根据需要调整转换参数：
   - 图像尺寸：设置模型输入的宽度和高度
   - ONNX操作集版本：选择适合的ONNX版本
   - 简化模型：启用可减小模型大小
   - 半精度 (FP16)：降低精度以减小模型大小和提高推理速度
5. 点击"转换"按钮开始转换过程
6. 转换完成后，可以使用ONNX模型在各种推理框架中部署

### 数据集划分
1. 点击"数据集划分"按钮打开划分工具
2. 设置数据集源路径和目标路径
3. 配置训练集、验证集和测试集比例
4. 支持带特征点的数据集划分

### 导出与部署
1. 训练完成后，模型权重文件会保存在指定的输出目录
2. 可以使用这些权重文件进行推理或进一步的自动标注
3. 支持导出标注数据为其他格式，方便与其他工具集成
4. 使用模型转换功能将PT模型转换为ONNX格式，便于在更多平台上部署

## 技术架构 (Technical Architecture)
- 基于PyQt5构建的现代化图形界面
- 采用模块化设计，清晰的代码组织结构
- 集成YOLOv8算法，支持目标检测和关键点检测
- 使用i18n国际化支持
- 完善的日志记录系统，便于问题排查

## 常见问题与解决方案 (FAQ)
- 如果遇到图像加载失败，请检查图像格式是否受支持
- 自动标注效果不佳时，可尝试调整置信度阈值或使用更适合的预训练模型
- 训练过程中如遇到内存不足，可减小批次大小或图像尺寸
- 标注文件保存失败时，请检查文件夹权限设置
- 特征点标注模式下无法添加特征点，请确认当前边界框是否已选中
- 模型转换失败时，确保已安装onnx和onnxruntime库，并检查日志获取详细错误信息

## 更新日志 (Changelog)
- 2025.08.23 修复模型训练，模型格式转换和模型结构查看的已知bug。新增数据集配置扫描更新功能。
- 2025.07.03 新增PT模型转ONNX功能，支持自定义输入尺寸、操作集版本和精度选项。新增查看模型格式功能，支持一键复制模型信息。
- 2025.06.30 优化项目结构，修改读取标签文件时可能导致标签确实的bug。优化代码注释。
- 2025.06.22 修改数据划分功能，实现对带特征点的数据集的划分。修改模型训练功能，实现可配置是否训练带特征点的模型
- 2025.06.21 修改特征点标注功能已知bug。新增图像拖动功能，在图像上按住鼠标中键即可进行拖动
- 2025.04.29 新增带特征点的模型自动标注功能。新增特征点标注模式，可以手动绘制特征点，左键单击进行绘制，左键单击进行拖动，右键双击删除

## 贡献指南 (Contributing)
欢迎贡献代码、报告问题或提出新功能建议！请通过GitHub Issues提交问题，或通过Pull Requests提交代码改进。

## 许可证 (License)
本项目基于[LICENSE](LICENSE)开源许可证发布。